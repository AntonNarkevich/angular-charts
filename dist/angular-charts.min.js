angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$window",function(a,b,c){function d(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b}function e(e,i,j){function k(){z=e[j.acData],G=e[j.acChart],n(),l(),m();var a=o(G);a(),x()}function l(){if(!h.legend.display)return C=I,D=H,void 0;switch(h.legend.position){case"top":case"bottom":C=.75*I,D=H;break;case"left":case"right":C=I,D=.75*H}}function m(){var c=a.get(h.legend.position);i.html(b(c)(e)),E=i.find(".ac-chart"),F=i.find(".ac-legend"),C-=i.find(".ac-title").height()}function n(){A=z.series,B=z.data,e[j.acConfig]&&(angular.extend(h,e[j.acConfig]),e.config=h)}function o(a){var b={pie:s,bar:p,line:q,area:r,point:t};return b[a]}function p(){var a={top:0,right:20,bottom:30,left:40};D-=a.left-a.right,C-=a.top-a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,D],.1),c=d3.scale.linear().range([C,10]),d=d3.scale.ordinal().rangeRoundBands([0,D],.1),f=[0];B.forEach(function(a){a.nicedata=a.y.map(function(b,c){return f.push(b),{x:a.x,y:b,s:c}})});var g=d3.max(B.map(function(a){return a.y.length}));e.yMaxData=g,b.domain(B.map(function(a){return a.x}));var i=.2*d3.max(f);c.domain([d3.min(f),d3.max(f)+i]),d.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var j=d3.svg.axis().scale(b).orient("bottom"),k=d3.svg.axis().scale(c).orient("left").ticks(10).tickFormat(d3.format("s")),l=d3.select(E[0]).append("svg").attr("width",D+a.left+a.right).attr("height",C+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(j),l.append("g").attr("class","y axis").call(k);var m=l.selectAll(".state").data(B).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+b(a.x)+",0)"}),n=m.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");n.attr("width",d.rangeBand()),h.animate?n.attr("x",function(a,b){return d(b)}).attr("y",C).style("fill",function(a){return y(a.s)}).attr("height",0).transition().ease("cubic-in-out").duration(1e3).attr("y",function(a){return c(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(c(a.y)-c(0))}):n.attr("x",function(a,b){return d(b)}).style("fill",function(a){return y(a.s)}).attr("y",function(a){return c(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(c(a.y)-c(0))}),n.on("mouseover",function(a){u(a.tooltip||a.y,event),h.mouseover(a,event),e.$apply()}).on("mouseleave",function(a){v(),h.mouseout(a,event),e.$apply()}).on("mousemove",function(){w(event)}).on("click",function(a){h.click.call(a,event),e.$apply()}),h.labels&&m.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return d(b)}).attr("y",function(a){return C-Math.abs(c(a.y)-c(0))}).text(function(a){return a.y}),l.append("line").attr("x1",D).attr("y1",c(0)).attr("y2",c(0)).style("stroke","silver")}function q(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};D-=b.left-b.right,C-=b.top-b.bottom;var c=d3.scale.ordinal().domain(B.map(function(a){return a.x})).rangeRoundBands([0,D]),d=d3.scale.linear().range([C,10]),f=d3.svg.axis().scale(c).orient("bottom"),g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),i=d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return d(a.y)}),j=[0],k=[];B.forEach(function(a){a.y.map(function(a){j.push(a)})});var l=d3.max(B.map(function(a){return a.y.length}));A.slice(0,l).forEach(function(a,b){var c={};c.series=a,c.values=B.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:B[b].x,y:0}}),k.push(c)});var m=d3.select(E[0]).append("svg").attr("width",D+b.left+b.right).attr("height",C+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),n=.2*d3.max(j);d.domain([d3.min(j),d3.max(j)+n]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(f),m.append("g").attr("class","y axis").call(g);var o=m.selectAll(".points").data(k).enter().append("g");path=o.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return y(b)}).attr("d",function(a){return i(a.values)}).attr("stroke-width","2").attr("fill","none");var p=k[k.length-1].values,q=path.node().getTotalLength()+a(p[p.length-1].x);return path.attr("stroke-dasharray",q+" "+q).attr("stroke-dashoffset",q).transition().duration(1500).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return i(a.values)}),angular.forEach(k,function(b){var c=m.selectAll(".circle").data(b.values).enter();c.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",y(k.indexOf(b))).style("stroke",y(k.indexOf(b))).on("mouseover",function(a){u(a.tooltip||a.y,event),h.mouseover(a,event),e.$apply()}).on("mouseleave",function(a){v(),h.mouseout(a,event),e.$apply()}).on("mousemove",function(){w(event)}).on("click",function(a){h.click(a,event),e.$apply()}),h.labels&&c.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})}),o.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(b){return"translate("+a(b.value.x)+","+d(b.value.y)+")"}).attr("x",3).text(function(a){return a.name}),k}function r(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};D-=b.left-b.right,C-=b.top-b.bottom;var c=d3.scale.ordinal().domain(B.map(function(a){return a.x})).rangeRoundBands([0,D]),d=d3.scale.linear().range([C,10]),f=d3.svg.axis().scale(c).orient("bottom"),g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),h=(d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return d(a.y)}),[0]),i=[];B.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(B.map(function(a){return a.y.length}));e.yMaxData=j,A.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=B.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:B[b].x,y:0}}),i.push(c)});var k=d3.select(E[0]).append("svg").attr("width",D+b.left+b.right).attr("height",C+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),l=.2*d3.max(h);d.domain([d3.min(h),d3.max(h)+l]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(f),k.append("g").attr("class","y axis").call(g);var m=k.selectAll(".points").data(i).enter().append("g"),n=d3.svg.area().interpolate("basis").x(function(b){return a(b.x)}).y0(function(){return d(0)}).y1(function(a){return d(0+a.y)});m.append("path").attr("class","area").attr("d",function(a){return n(a.values)}).style("fill",function(a,b){return y(b)}).style("opacity","0.7")}function s(){function a(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return d(b(a))}}var b=Math.min(D,C)/2,c=d3.select(E[0]).append("svg").attr("width",D).attr("height",C).append("g").attr("transform","translate("+D/2+","+C/2+")");e.yMaxData=B.length;{var d=d3.svg.arc().outerRadius(b-10).innerRadius(0),f=(d3.svg.arc().outerRadius(b+5).innerRadius(0),d3.layout.pie().sort(null).value(function(a){return a.y[0]})),g=c.selectAll(".arc").data(f(B)).enter().append("g");g.append("path").style("fill",function(a,b){return y(b)}).transition().ease("linear").duration(500).attrTween("d",a).attr("class","arc")}g.on("mouseover",function(a){u(a.data.tooltip||a.data.y[0]),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),h.onmouseover(a,event),e.$apply()}).on("mouseleave",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),v(),h.onmouseout(a,event),e.$apply()}).on("mousemove",function(){w(event)}).on("click",function(a){h.click(a,event),e.$apply()}),h.labels&&g.append("text").attr("transform",function(a){return"translate("+d.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})}function t(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};D-=b.left-b.right,C-=b.top-b.bottom;var c=d3.scale.ordinal().domain(B.map(function(a){return a.x})).rangeRoundBands([0,D]),d=d3.scale.linear().range([C,10]),f=d3.svg.axis().scale(c).orient("bottom"),g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),i=[0],j=[];B.forEach(function(a){a.y.map(function(a){i.push(a)})});var k=d3.max(B.map(function(a){return a.y.length}));A.slice(0,k).forEach(function(a,b){var c={};c.series=a,c.values=B.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:B[b].x,y:0}}),j.push(c)});var l=d3.select(E[0]).append("svg").attr("width",D+b.left+b.right).attr("height",C+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),m=.2*d3.max(i);d.domain([d3.min(i),d3.max(i)+m]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(f),l.append("g").attr("class","y axis").call(g);l.selectAll(".points").data(j).enter().append("g");angular.forEach(j,function(b){var c=l.selectAll(".circle").data(b.values).enter();c.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",y(j.indexOf(b))).style("stroke",y(j.indexOf(b))).on("mouseover",function(a){u(a.tooltip||a.y,event),h.mouseover(a,event),e.$apply()}).on("mouseleave",function(a){v(),h.mouseout(a,event),e.$apply()}).on("mousemove",function(){w(event)}).on("click",function(a){h.click(a,event),e.$apply()}),h.labels&&c.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})})}function u(a,b){h.tooltips&&angular.element('<p class="ac-tooltip" style="'+f+'"></p>').html(a).appendTo("body").fadeIn("slow").css({left:b.pageX+20,top:b.pageY-30})}function v(){angular.element(".ac-tooltip").remove()}function w(a){angular.element(".ac-tooltip").css({left:a.pageX+20,top:a.pageY-30})}function x(){e.legends=[],"pie"==G&&angular.forEach(B,function(a,b){e.legends.push({color:g[b],title:a.x})}),("bar"==G||"area"==G)&&angular.forEach(A,function(a,b){e.legends.push({color:g[b],title:a})})}function y(a){if(a<g.length)return g[a];var b=d();return g.push(b),b}var z,A,B,C,D,E,F,G,H=i.width(),I=i.height(),J=angular.element(c);e.getWindowDimensions=function(){return{h:J.height(),w:J.width()}},e.$watch(j.acChart,function(){k()},!0),e.$watch(j.acData,function(){k()},!0),e.$watch(j.acConfig,function(){k()},!0)}var f=["display:none;","position:absolute;","border:1px solid #333;","background-color:#161616;","border-radius:5px;","padding:5px;","color:#fff;"].join(""),g=["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],h={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left"}};return{restrict:"EA",link:e}}]),angular.module("angularChartsTemplates",["left","right"]),angular.module("left",[]).run(["$templateCache",function(a){a.put("left","\n<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{config.title}}</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{config.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends\">\n		<td><div style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n<div class='ac-chart' style='float:left; width:75%;'>\n</div>")}]),angular.module("right",[]).run(["$templateCache",function(a){a.put("right","<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{config.title}}</div>\n<div class='ac-chart' style='float:left; width:75%;'>\n</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{config.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends | limitTo:yMaxData\">\n		<td><div style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>")}]);